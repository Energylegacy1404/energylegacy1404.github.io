<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>Ù†Ù‚Ø´Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§ - Ø§ÛŒØ±Ø§Ù†ØŒ Ø±ÙˆØ³ÛŒÙ‡ØŒ Ú†ÛŒÙ†ØŒ Ú©Ø§Ù†Ø§Ø¯Ø§</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Vazir', 'Tahoma', Arial, sans-serif;
            background: linear-gradient(135deg, #001b96 0%, #04004a 100%);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .map-container {
            position: relative;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            flex: 1;
        }
        
        #map {
            height: 600px;
            width: 100%;
            background: #a5d6f9;
            border-radius:20px;
            z-index: 1;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ø´ÙˆØ±Ù‡Ø§ - Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø·Ù„Ù‚ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ */
        .country-marker {
            position: absolute;
            padding: 8px 20px;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            white-space: nowrap;
            z-index: 1000;
            border: 2px solid white;
            transition: all 0.3s ease;
            pointer-events: none;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
        }
        
        .country-marker:hover {
            transform: translate(-50%, -60%) scale(1.1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        /* Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù…ØªÙØ§ÙˆØª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ú©Ø´ÙˆØ± */
        .country-marker.iran {
            background: linear-gradient(45deg, #239f3f, #1e7a31);
            border-color: #fedd00;
        }
        
        .country-marker.russia {
            background: linear-gradient(45deg, #d52b1e, #9e1f15);
            border-color: #0039a6;
        }
        
        .country-marker.china {
            background: linear-gradient(45deg, #de2910, #b0200c);
            border-color: #ffde00;
        }
        
        .country-marker.canada {
            background: linear-gradient(45deg, #d52b1e, #a9201a);
            border-color: #ffffff;
        }
        
        /* Ø±Ø§Ù‡Ù†Ù…Ø§ */
        <!-- .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 1001;
            backdrop-filter: blur(10px);
            max-width: 300px;
            width: calc(100% - 40px);
            border: 1px solid rgba(255,255,255,0.3);
        }
         -->
        .legend h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 10px;
            background: rgba(0,0,0,0.02);
        }
        
        .color-box {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
            border: 2px solid white;
        }
        
        .iran-box { background: linear-gradient(45deg, #239f3f, #fedd00, #d52b1e); }
        .russia-box { background: linear-gradient(45deg, #d52b1e, #0039a6); }
        .china-box { background: linear-gradient(45deg, #de2910, #ffde00); }
        .canada-box { background: linear-gradient(45deg, #d52b1e, #ffffff); }
        
        .coordinates {
            font-size: 12px;
            color: #666;
            margin-right: 10px;
            direction: ltr;
        }
        
        /* Ø¯Ú©Ù…Ù‡ Ú©Ù†ØªØ±Ù„ */
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            background: white;
            color: #333;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            background: #f0f0f0;
        }
        
        /* Ø­Ø§Ù„Øª Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            #map {
                height: 500px;
            }
            
            .country-marker {
                padding: 5px 12px;
                font-size: 12px;
            }
            
            .legend {
                bottom: 10px;
                left: 10px;
                padding: 15px;
                width: calc(100% - 20px);
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 12px;
            }
            
            .map-controls {
                top: 10px;
                right: 10px;
            }
        }
        
        @media (max-width: 480px) {
            #map {
                height: 400px;
            }
            
            .country-marker {
                padding: 4px 10px;
                font-size: 10px;
                border-width: 1.5px;
            }
            
            .legend h3 {
                font-size: 1rem;
            }
            
            .legend-item {
                font-size: 12px;
            }
        }
        
        /* Ø­Ø§Ù„Øª Ø§ÙÙ‚ÛŒ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-height: 600px) and (orientation: landscape) {
            #map {
                height: 300px;
            }
        }
        
        /* ÙÙˆØªØ± */
        footer {
            text-align: center;
            color: white;
            margin-top: 20px;
            opacity: 0.9;
            font-size: 14px;
        }
        .map-point {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: red;
            cursor: pointer;
        }
        
        /* tooltip Ù…Ø®ÙÛŒ */
        .point-tooltip {
            position: absolute;
            bottom: 22px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 8px 10px;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: 0.25s;
        }
        
        /* ÙÙ„Ø´ Ú©ÙˆÚ†ÛŒÚ© */
        .point-tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: rgba(0,0,0,0.85) transparent transparent transparent;
        }
        
        /* Ù‡Ù†Ú¯Ø§Ù… Ù‡Ø§ÙˆØ± */
        .map-point:hover .point-tooltip {
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ Ù†Ù‚Ø´Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§ÛŒ Ù…Ù†ØªØ®Ø¨</h1>
    
    <div class="map-container">
        <!-- Ø§Ù„Ù…Ø§Ù† Ù†Ù‚Ø´Ù‡ -->
        <div id="map"></div>
        
        <!-- Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ø´ÙˆØ±Ù‡Ø§ (Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ù…Ø®ÙÛŒØŒ Ø¨Ø§ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´Ù†) -->
        <div id="iran-marker" class="country-marker iran" style="display: none;">Ø§ÛŒØ±Ø§Ù†
            <div class="map-point iran">
                <div class="point-tooltip">
                    <strong>Ø§ÛŒØ±Ø§Ù†</strong><br>
                    Ù†ÙØª Ùˆ Ú¯Ø§Ø²: Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§<br>
                    Ø±ØªØ¨Ù‡ Ø¬Ù‡Ø§Ù†ÛŒ: Ø¬Ø²Ùˆ Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒÙ† Ø¯Ø§Ø±Ù†Ø¯Ú¯Ø§Ù† Ø°Ø®Ø§ÛŒØ±
                </div>
            </div>
        </div>
        <div id="russia-marker" class="country-marker russia" style="display: none;">Ø±ÙˆØ³ÛŒÙ‡</div>
        <div id="china-marker" class="country-marker china" style="display: none;">Ú†ÛŒÙ†</div>
        <div id="canada-marker" class="country-marker canada" style="display: none;">Ú©Ø§Ù†Ø§Ø¯Ø§</div>

        <div class="map-controls">
            <button class="btn" onclick="showAllCountries()">ğŸŒ Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡</button>
            <button class="btn" onclick="zoomToCountry('iran')">ğŸ‡®ğŸ‡· Ø§ÛŒØ±Ø§Ù†</button>
            <button class="btn" onclick="zoomToCountry('russia')">ğŸ‡·ğŸ‡º Ø±ÙˆØ³ÛŒÙ‡</button>
            <button class="btn" onclick="zoomToCountry('china')">ğŸ‡¨ğŸ‡³ Ú†ÛŒÙ†</button>
            <button class="btn" onclick="zoomToCountry('canada')">ğŸ‡¨ğŸ‡¦ Ú©Ø§Ù†Ø§Ø¯Ø§</button>
        </div>
    </div>
    
    <footer>
        Ù†Ù‚Ø´Ù‡ ØªØ¹Ø§Ù…Ù„ÛŒ  
    </footer>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // ========== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù†Ù‚Ø´Ù‡ ==========
        
        // Ù…Ø®ØªØµØ§Øª Ú©Ø´ÙˆØ±Ù‡Ø§
        const countries = {
            iran: {
                name: 'Ø§ÛŒØ±Ø§Ù†',
                lat: 35.6892,
                lng: 51.3890,
                element: 'iran-marker',
                flag: 'ğŸ‡®ğŸ‡·',
                capital: 'ØªÙ‡Ø±Ø§Ù†'
            },
            russia: {
                name: 'Ø±ÙˆØ³ÛŒÙ‡',
                lat: 55.7558,
                lng: 37.6173,
                element: 'russia-marker',
                flag: 'ğŸ‡·ğŸ‡º',
                capital: 'Ù…Ø³Ú©Ùˆ'
            },
            china: {
                name: 'Ú†ÛŒÙ†',
                lat: 39.9042,
                lng: 116.4074,
                element: 'china-marker',
                flag: 'ğŸ‡¨ğŸ‡³',
                capital: 'Ù¾Ú©Ù†'
            },
            canada: {
                name: 'Ú©Ø§Ù†Ø§Ø¯Ø§',
                lat: 45.4215,
                lng: -75.6972,
                element: 'canada-marker',
                flag: 'ğŸ‡¨ğŸ‡¦',
                capital: 'Ø§ØªØ§ÙˆØ§'
            }
        };

        // ========== Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡ ==========
        const map = L.map('map', {
            center: [30, 30],  // Ù…Ø±Ú©Ø² Ø§ÙˆÙ„ÛŒÙ‡
            zoom: 2,           // Ø²ÙˆÙ… Ø§ÙˆÙ„ÛŒÙ‡
            zoomControl: true,
            fadeAnimation: true,
            zoomAnimation: true,
            markerZoomAnimation: true
        });

        // ========== Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§ÛŒÙ‡ Ù†Ù‚Ø´Ù‡ ==========
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19,
            minZoom: 2
        }).addTo(map);

        // ========== ØªØ§Ø¨Ø¹ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ ==========
        function updateMarkers() {
            Object.keys(countries).forEach(countryId => {
                const country = countries[countryId];
                const markerElement = document.getElementById(country.element);
                
                if (!markerElement) return;
                
                // ØªØ¨Ø¯ÛŒÙ„ Ù…Ø®ØªØµØ§Øª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ Ø¨Ù‡ Ù¾ÛŒÚ©Ø³Ù„ Ø±ÙˆÛŒ ØµÙØ­Ù‡
                const point = map.latLngToContainerPoint(
                    L.latLng(country.lat, country.lng)
                );
                
                // ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù„Ù…Ø§Ù†
                markerElement.style.display = 'block';
                markerElement.style.position = 'absolute';
                markerElement.style.left = point.x + 'px';
                markerElement.style.top = point.y + 'px';
                markerElement.style.transform = 'translate(-50%, -50%)';
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø­ØªÙˆØ§ (Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ)
                const isMobile = window.innerWidth <= 768;
                const isVerySmall = window.innerWidth <= 480;
                
                if (isVerySmall) {
                    markerElement.innerHTML = `${country.flag} ${country.name.substring(0, 2)}`;
                } else if (isMobile) {
                    markerElement.innerHTML = `${country.flag} ${country.name}`;
                } else {
                    markerElement.innerHTML = `${country.flag} ${country.name} - ${country.capital}`;
                }
            });
        }

        // ========== Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ ==========
        
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± Ø­Ø±Ú©Øª Ù†Ù‚Ø´Ù‡
        map.on('moveend', updateMarkers);
        map.on('zoomend', updateMarkers);
        map.on('resize', function() {
            setTimeout(updateMarkers, 50);  // ØªØ§Ø®ÛŒØ± Ú©ÙˆØªØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§Ø¹Ù…Ø§Ù„ resize
        });

        // ========== Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù¾Ù†Ø¬Ø±Ù‡ ==========
        
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø§ ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù¾Ù†Ø¬Ø±Ù‡
        window.addEventListener('resize', function() {
            map.invalidateSize();  // Ù…Ù‡Ù…: Ø¨Ù‡ Ù†Ù‚Ø´Ù‡ Ù…ÛŒâ€ŒÚ¯Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡
            setTimeout(updateMarkers, 50);
        });

        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± Ù„ÙˆØ¯ Ø§ÙˆÙ„ÛŒÙ‡
        window.addEventListener('load', function() {
            setTimeout(updateMarkers, 100);
        });

        // ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù†ØªØ±Ù„ Ù†Ù‚Ø´Ù‡ ==========
        
        // Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§
        window.showAllCountries = function() {
            const bounds = L.latLngBounds([
                [countries.iran.lat, countries.iran.lng],
                [countries.russia.lat, countries.russia.lng],
                [countries.china.lat, countries.china.lng],
                [countries.canada.lat, countries.canada.lng]
            ]);
            
            map.fitBounds(bounds, {
                padding: [50, 50],
                maxZoom: 5,
                animate: true,
                duration: 1
            });
        };

        // Ø²ÙˆÙ… Ø±ÙˆÛŒ Ú©Ø´ÙˆØ± Ø®Ø§Øµ
        window.zoomToCountry = function(countryId) {
            const country = countries[countryId];
            if (!country) return;
            
            map.flyTo([country.lat, country.lng], 6, {
                animate: true,
                duration: 1.5
            });
        };

        // ========== Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú†Ù†Ø¯ Ù†Ù‚Ø·Ù‡ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø§ Marker (Ù¾Ø´ØªÛŒØ¨Ø§Ù†) ==========
        
        // Ø§ÛŒØ¬Ø§Ø¯ markerÙ‡Ø§ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒ Leaflet Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†
        Object.keys(countries).forEach(countryId => {
            const country = countries[countryId];
            
            // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ - marker Ø³Ø§Ø¯Ù‡
            L.marker([country.lat, country.lng], {
                opacity: 0.7,
                interactive: false  // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¹Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ø¹Ø¯Ù… ØªØ¯Ø§Ø®Ù„
            }).addTo(map);
        });

        // ========== Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ==========
        setTimeout(() => {
            updateMarkers();
            showAllCountries();  // Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹
        }, 200);

        // ========== Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ ==========
        window.onerror = function(msg, url, line) {
            console.log('Ø®Ø·Ø§:', msg, 'Ø¯Ø± Ø®Ø·:', line);
            return false;
        };

        // ========== Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² touch devices ==========
        if (window.innerWidth <= 768) {
            map.dragging.enable();
            map.touchZoom.enable();
            map.doubleClickZoom.enable();
            map.scrollWheelZoom.enable();
        }

        // ========== Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± localStorage (Ø¢Ù¾Ø´Ù†Ø§Ù„) ==========
        function saveMapPosition() {
            const center = map.getCenter();
            const zoom = map.getZoom();
            localStorage.setItem('mapPosition', JSON.stringify({
                lat: center.lat,
                lng: center.lng,
                zoom: zoom
            }));
        }

        function loadMapPosition() {
            const saved = localStorage.getItem('mapPosition');
            if (saved) {
                try {
                    const pos = JSON.parse(saved);
                    map.setView([pos.lat, pos.lng], pos.zoom);
                } catch(e) {
                    console.log('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª');
                }
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…ÙˆÙ‚Ø¹ Ø®Ø±ÙˆØ¬
        window.addEventListener('beforeunload', saveMapPosition);
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
        setTimeout(loadMapPosition, 300);
        
    </script>

    <!-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÙˆÙ†Øª ÙˆØ²ÛŒØ± Ø¨Ø±Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" type="text/css" />
</body>
</html>